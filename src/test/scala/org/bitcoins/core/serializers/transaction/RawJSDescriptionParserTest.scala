package org.bitcoins.core.serializers.transaction

import org.bitcoins.core.currency.Satoshis
import org.bitcoins.core.number.Int64
import org.bitcoins.core.protocol.transaction.JSDescription
import org.bitcoins.core.util.BitcoinSUtil
import org.scalatest.{FlatSpec, MustMatchers}

/**
 * Created by str4d on 3/26/18.
 */
class RawJSDescriptionParserTest extends FlatSpec with MustMatchers {

  val encode = BitcoinSUtil.encodeHex(_: Seq[Byte])

  // Standard JoinSplit (z->t) (mainnet tx dc10f21bcd769f8ea2e075fd193d09761470e79cf46b31d0ac59e483adf74422)
  val rawJSDesc1 = "0000000000000000fa5d3647000000000896345021a8562f8e3dc67e70d2f2290a409010499e4cfb7eb6dd724ad91e24b3d68f671d6b888b45c98b9f1008a7c6485bd9b6c0337e61a5876dfb960b353d4c1d28f4098c63d032704d45147b3f48818bdeba25d11528f8e964c6ba54d3ae1dc340b1afeb90502af5277e69b73032be6ce088ffa9bb770bf767cdd98cd2fc218adf288b607667c6a78cd841e4c2a577dcac1e244fed808a42675f5e82df3681cb80387ee2bed175142a549e6d472808e1dc3ed8a52a8d40181561f0cd8759d43994c19b3330b000ead080778d56d3cce15e3c9a989d6f3d94227a00e95115bab6010e664aced6d007fa3e8dcd65e45502ad384b4fc73a0a13be76648f3d262c13deae0c7427bdf754542915586c3cc9b1a1e4c6791218c0f3915b6efe34c10317b334db90c8749058f2404275ab8f735fd4f0e2eb8a878bb500ec6a5c26ca43020205ddf30a009ce6a21c54fad88e9dec07d6d3630db6ee3e12b04940f6a0fba00b02747fd2af896188701bd2dec8b3a3a43362b9a1603717f30f70e7f63c59fd90dcdab674a6f3cf45d989c5ebdc8457dc2af27d05fa920e9553c80b5fdbb28573021ae476f72a3398f9d59addf5c2e93358adac2854748d8ebc0df731e23bc63c17032c41baccadfabc31b767413e394c2cc5210e05bb0fb43dbb75a8aed831c3fd3f0214bb069c6576ae30157321be13efe604830d6d9d530470196e8ec8c75a5826e9030d2ce45777d8049ef7ec5fbf45a2372dd17f470c3757bbd4ac751a7dc74b376403059ab875b8575ac473e8aed90583e6167d3592cbf572da758d8643ef22bda7d285d20ede4ec208e908bda35725eb9346f80265e99fd8ac5033e7fc4ac97bfb8ac897d2db104ed5b8910e1771c77beab0c4984ad8fa9d0a5eea0d53feae032254198f317280bef2825e285825bd8f2502768837f212c2c0e6a15438d6cd732f1561199aa19138d569cbda098ef664c768f332683c2dab7e89656c60e04fefa63fb6331d2d3d492ab1f3d509548f9bcd03c2fe8bee187e38c40bcb294006e5fa0754eacebf364c17cd7f8b2aed7a2df1176ac7f129196c470ab198967800dfeff7f9703f3ac1f853e55f989cc645cc82c1196ddea100d1fd5826c621e43cc9053733ad1e7237ceadf87ff36a50da72e1d3c79b152e586678c6635aacc789e1a0db62886d3312f12f3224983572d19ddc192f96c49b9886c32ccf061e61f409245c74a0125d8f768f18e550f923763856cc4421f17bce7ce49eeaa7272bd04b32d59fee69918b4601581b74bd4b9ce6d72ed5708a8529dcc863ce060950f842834ffd91fdab9bfd1a65499dc546878fcf071d7ecbf1d7ba3e5f102a78652a3507c18b5d0cd247e619a42def1182c27116522bb4387543f193ade62ae8e0da12a91abcaf7b2c0a355ecd66a8285fb57e810c39e87d38fa3de9e5636972536068447ff7947d4ce6304c36b4129136faeac52f14a424c71620fcb70f3f5d629f096be36f427d501c7bf9e76bb363ef94fa4324e8be4b0f04cbcd2eeec8e82316ab1c03194ad5e5f5ed53ad0f87daf47180c5b0b64e16ffb83741af655b0f9e614c6673b5e42bd47564f4fd47c317f5b8a96026d36842b1f800530c6710ba930ff6a54dacccd15f38e032e52b64d3952775f01f6732d160b44ec8fdfb8cbc39caa364f30eea1c1e04c7b2171034ceb17af0427555cb23e910ab0a92148935dab60632c909fe2875e7600592795a4c2894d529ee7c4df9e3afde9722b2e99277f282ff42ecc7e0e17737f27c09f854329614be2f6407dffcee5061791fed26478eff264a5ddb7d28f776f1c92d2887ecb77d6e3d9b52f1852a6ee99320e1fbfea0faa37704c7ce001c799c6fd893355a1e034601a46824c72a208e6e7dc3a34904e1bb25bb751022be9e0f92929127d431f69200d7873b7d14fd460d4c9e6cd123bb34e7b63a263609e15af3aa876f5af562bdec50b1776632cd8f7a3feaf43a8aafae77a18bbc99b2c1b45d03dedfa9ecd47a43039e3a6f6b6c0b52087d6a2157bab88d4b1145c9e7d9636034ffc8c01ffc41633c616f63ac5748ff29bf57310f14a47536b6c721a17f4a6c4a80ade75458fa9a9c68fa5ae0114727202b742be49b0fac464dc6a9be0fc90a68aad9b03957da431aaa0d84bc0a6c5f557eb37f050a5d842d683464fb20eb99f0aadb4e5b3d0f153cff4502b1fa72ed1e28b108ca3dca25964e7f3a1454a73603fb3edfd03432e45746df627120fe73d7d4ff685c909ef4f34c9ac33936805db944fbc5dad223b3c456e530b0c4448508fe7a92031b0b18929a4ac4dab9aae70fbe394e4c3fd9fbe58f327c96b45434ecbd979785184de3b4d5dd313af93da5206f27a5c5c8cf6f226f6eace845d2142c32dfcebcb780b87593f384fc6ced73b3ebd054f38b60cc0f3b069eefb6797fce79ea8f9b8b86c47abaf203c79e9ccf689806fbdd896edf29f75ebdfb1fa789a18611cf9c4b40a4c8b6853415f1c1e7b446ce50e879c13fc5c1"
  "RawJSDescriptionTest" must "read a serialized Sprout proof" in {
    val jsdesc : JSDescription = RawJSDescriptionParser.read(rawJSDesc1)
    jsdesc.vpubOld must be (Satoshis(Int64(0)))
    jsdesc.vpubNew must be (Satoshis(Int64(1194745338)))
    encode(jsdesc.anchor.reverse) must be ("241ed94a72ddb67efb4c9e491090400a29f2d2707ec63d8e2f56a82150349608")
    jsdesc.nullifiers.map(nf => encode(nf.reverse)) must be (List(
      "3d350b96fb6d87a5617e33c0b6d95b48c6a708109f8bc9458b886b1d678fd6b3",
      "aed354bac664e9f82815d125bade8b81483f7b14454d7032d0638c09f4281d4c"))
    jsdesc.commitments.map(cm => encode(cm.reverse)) must be (List(
      "fcd28cd9cd67f70b77bba9ff88e06cbe3230b7697e27f52a5090ebafb140c31d",
      "36df825e5f67428a80ed4f241eacdc77a5c2e441d88ca7c66776608b28df8a21"))
    encode(jsdesc.onetimePubKey.reverse) must be ("5987cdf0611518408d2aa5d83edce10828476d9e542a1475d1bee27e3880cb81")
    encode(jsdesc.randomSeed.reverse) must be ("1551e9007a22943d6f9d989a3c5ee1ccd3568d7780d0ea00b030339bc19439d4")
    jsdesc.macs.map(mac => encode(mac.reverse)) must be (List(
      "263d8f6476be130a3ac74f4b38ad0255e465cd8d3efa07d0d6ce4a660e01b6ba",
      "c134fe6e5b91f3c0181279c6e4a1b1c93c6c5815295454f7bd27740caede132c"))
    jsdesc.proof.hex must be ("0317b334db90c8749058f2404275ab8f735fd4f0e2eb8a878bb500ec6a5c26ca43020205ddf30a009ce6a21c54fad88e9dec07d6d3630db6ee3e12b04940f6a0fba00b02747fd2af896188701bd2dec8b3a3a43362b9a1603717f30f70e7f63c59fd90dcdab674a6f3cf45d989c5ebdc8457dc2af27d05fa920e9553c80b5fdbb28573021ae476f72a3398f9d59addf5c2e93358adac2854748d8ebc0df731e23bc63c17032c41baccadfabc31b767413e394c2cc5210e05bb0fb43dbb75a8aed831c3fd3f0214bb069c6576ae30157321be13efe604830d6d9d530470196e8ec8c75a5826e9030d2ce45777d8049ef7ec5fbf45a2372dd17f470c3757bbd4ac751a7dc74b376403059ab875b8575ac473e8aed90583e6167d3592cbf572da758d8643ef22bda7d2")
    jsdesc.ciphertexts.map(ct => encode(ct)) must be (List(
      "85d20ede4ec208e908bda35725eb9346f80265e99fd8ac5033e7fc4ac97bfb8ac897d2db104ed5b8910e1771c77beab0c4984ad8fa9d0a5eea0d53feae032254198f317280bef2825e285825bd8f2502768837f212c2c0e6a15438d6cd732f1561199aa19138d569cbda098ef664c768f332683c2dab7e89656c60e04fefa63fb6331d2d3d492ab1f3d509548f9bcd03c2fe8bee187e38c40bcb294006e5fa0754eacebf364c17cd7f8b2aed7a2df1176ac7f129196c470ab198967800dfeff7f9703f3ac1f853e55f989cc645cc82c1196ddea100d1fd5826c621e43cc9053733ad1e7237ceadf87ff36a50da72e1d3c79b152e586678c6635aacc789e1a0db62886d3312f12f3224983572d19ddc192f96c49b9886c32ccf061e61f409245c74a0125d8f768f18e550f923763856cc4421f17bce7ce49eeaa7272bd04b32d59fee69918b4601581b74bd4b9ce6d72ed5708a8529dcc863ce060950f842834ffd91fdab9bfd1a65499dc546878fcf071d7ecbf1d7ba3e5f102a78652a3507c18b5d0cd247e619a42def1182c27116522bb4387543f193ade62ae8e0da12a91abcaf7b2c0a355ecd66a8285fb57e810c39e87d38fa3de9e5636972536068447ff7947d4ce6304c36b4129136faeac52f14a424c71620fcb70f3f5d629f096be36f427d501c7bf9e76bb363ef94fa4324e8be4b0f04cbcd2eeec8e82316ab1c03194ad5e5f5ed53ad0f87daf47180c5b0b64e16ffb83741af655b0f9e614c6673b5e42bd47564f4fd47c317f5b8a96026d36842b1f800530c6710ba930ff6a54dacccd15f38e032e52b64d3952775f01f6732d160b44ec8fdfb",
      "8cbc39caa364f30eea1c1e04c7b2171034ceb17af0427555cb23e910ab0a92148935dab60632c909fe2875e7600592795a4c2894d529ee7c4df9e3afde9722b2e99277f282ff42ecc7e0e17737f27c09f854329614be2f6407dffcee5061791fed26478eff264a5ddb7d28f776f1c92d2887ecb77d6e3d9b52f1852a6ee99320e1fbfea0faa37704c7ce001c799c6fd893355a1e034601a46824c72a208e6e7dc3a34904e1bb25bb751022be9e0f92929127d431f69200d7873b7d14fd460d4c9e6cd123bb34e7b63a263609e15af3aa876f5af562bdec50b1776632cd8f7a3feaf43a8aafae77a18bbc99b2c1b45d03dedfa9ecd47a43039e3a6f6b6c0b52087d6a2157bab88d4b1145c9e7d9636034ffc8c01ffc41633c616f63ac5748ff29bf57310f14a47536b6c721a17f4a6c4a80ade75458fa9a9c68fa5ae0114727202b742be49b0fac464dc6a9be0fc90a68aad9b03957da431aaa0d84bc0a6c5f557eb37f050a5d842d683464fb20eb99f0aadb4e5b3d0f153cff4502b1fa72ed1e28b108ca3dca25964e7f3a1454a73603fb3edfd03432e45746df627120fe73d7d4ff685c909ef4f34c9ac33936805db944fbc5dad223b3c456e530b0c4448508fe7a92031b0b18929a4ac4dab9aae70fbe394e4c3fd9fbe58f327c96b45434ecbd979785184de3b4d5dd313af93da5206f27a5c5c8cf6f226f6eace845d2142c32dfcebcb780b87593f384fc6ced73b3ebd054f38b60cc0f3b069eefb6797fce79ea8f9b8b86c47abaf203c79e9ccf689806fbdd896edf29f75ebdfb1fa789a18611cf9c4b40a4c8b6853415f1c1e7b446ce50e879c13fc5c1"))
  }

  // Standard JoinSplit (t->z) (mainnet tx b4b838ee6eb809e8ffae99b85cd6dab95dc864993e256a7e1dd7f0c464e0c8d8)
  val rawJSDesc2 = "57319d3b000000000000000000000000368fbb77f0430af3e5b176242c41c2c7f6a220b1aa26b42d6ee147d48da873479e3a6a587abc7aaa0f2b5d64ba74774adcf1343ab43c75460c2c6dac6261f3588cc98d181483c9aaba09b990ae0df3a94f1bfde49eeb5fb96b0fe6ea0ec31ccf0ca259e4de76d3a22be2b9e684e51846c85c1ded3cab2d0594eeaeaf7eeb0005aa1fc574a54d5aa1967bb4ebfe6c80ea18402e05eb26634d3d847b11e21ab71714a8462eef9992074f144814d9caf1ddee712e46fab5afff518a5189edc8f451bba912058a729743530ae40fd9f7ea681d9f753d9d699afa75d93b0d3f153dbdad81a6f500d6a9f4007aba9d5a04880275d2c11807541043e8e1a8df8f755bc42394dc6bd0bf0769a8457abb7bb2ecac1abe547fdae67d3a99b22bc6cc49c3f6020d33cf689264dfbe12e42806e8597b9834ef127c4723ac06e96645731e486438031e29277c1bba25160ed46433e20ed031cbf3c593119171ba79e45a5e3d88e11c0a052150e32a281f231cb71fb408ef2b5757413c6d5c83e8b13aa915053a0689678b87d60bd814b5a985ddc0452e12964bd42534d355c2bd3ed645b79a5c2d171c022760b09bebeded7c95ca8046d64eb1a06ee52fc00e5183fa37c2b9a600bb679f0221422fdb7f491fc51adc33820a5ad4f6c8a01f8f75b5e9a453c7aa16a108a68302105f99acfb406c86412b5c6bdf1a9a86538c6e92327ac11c853d28b184708aaf021b416342c222c1f6b3bcd91dfcf70acee747e0b7f8979b83d8cd539d4743ebec0328c3d7cf3a8c009ae97139ffe2ff65d4e4cfe9c69bf385f8c38065628684447724b091f8e0d07ed8a031ca3d3072808518f8fb7706e6fa02fd368fa96a411c5a908b1c35906b0cd63e5792f41accf445e50e8202d264bc03fdfa881c01f8fd6c72e5bc53b81130be846815951b774dfee70f43a9391041822ec3f3ff7cbdc2d6566e5c2141b53e229133b39a2cd229eb941b8ddcfe02546950bd83925eec3c5061edd461bfbeddeeffae15c437f5b62c18bf41321ed394ff43183126dcdb998f96b34c717e6352cde474da63b4073a904ac48c458f00b606cb4cc5fbf08200d3e2bf637f730df86dcd18ffd033c47bbd26e8d669b80e3cc99ba4d9856d4202f3e119c8b6ed553201fd9b9138db486173bc9e3e42b6d5fb86190dfe52585e083eb982c67fb0a19945354be467cfb8d745d4e0b093f7b12a82b2e656e1e5ebfa44f83903f9b786589b4e56310fe8893f2a4333949d31df5abef6bd3020be995474d7d40954cde22d0dbfbb30edd252c341e1ccd121a3e09d80749caa290d231bc0018f65911a8b1d3f51ec30560366157ebf44b6efc1e6332f9b9bb5f8171f5a121043245daf7b9ab339716b51d808791b56525b5837fa24118a292358c7d81b02c0ea4d84047e17c19ab87c3c2a816c186dedfc60a78cd7aa7b1089fd7eb65865e0d1077975435545e67bda7a2f66f2dd5ab2bd3a4196fc206028ad2e291590af5138a348c383b78acdb0d8b72eb971ae5ab8536e30b76abe16255ce19c15f9797422d8cf401934d38f80e86532606c6e34beab39d57590d2c28f298115c368ca187cf2fd01244bdbe05d03386657a7b8548ce2156a1a6647b8dfada3de3db040786c987789281b6426dab5b01e49e3bc17fb1b831ae9a564442cd992f8f1f3f4e366356ff12370b775fd444e571377e652254fdd6adb30ae40815ee18fa4af7a76c0792eb0b621b118d8451c1a242938c43913b5386e03a7fea0f13a4b0381114016afc0ac43e6e3b1bc5bac8eb2c8bc814627c58ebdc548a7628ebffa6f6457445689fa397817757b3bf715456b86c0fb3df95cc0dc4a06f9e418489162143cadc1e295e6ac9aad88471477b53c2fd43bdf2730aa7fcc49f89dbac72d414d1836ab4cb34fd3fce1bd9b0645cf7beb42c811de3416280c229ea8d19af499570f013e7a8e1c9b7dcd57674e3422ac0f62cf8186a04890b98340186d371cf00850e986e3b71f8578fe75b6672a06ac475f0256a76ef45ac78e669a969eefd424703d857e8ee573c3303928d2441ea8f5928ce62bbe7ee91b81fa9a4aabde5a39917fb4624215090af2daec3da3795ea695b7aae1cfbaca12b80c0ab2f21e42b7a0cf457b026c459276b63217a4a31b381d703b3e53a92f189cbd3be3fc8034cf3f8651054073e2f0448bd1e806c93eb7c7e5d0bb9b2de21d51bacf216271b5cee9b445d61fa7f2d7aaf469003e1240fb562a17e81fdc3931ad64c35ddc1d99474fad4507d230e639a8db3f19f863d8dbc0127417f6175cde0b62945d5e6247623dcce23f3f2d05d62dc1c6339827dee5ac76d1e80fd2c82dd955bd62b3e20e065fa47806080544d1b97f89ddbeacfed10db77152e0983c5cca03010eedd8a40245e8035c95c08b6f2ab9e07aebdec03a4faf020997088b2773a0ff8b0b142e2b138d85d6b0107205aaecb012b35174f56d600eb80c77c3bf865ce5523f878d23fed4a8d9b92e14a6aa5e6f1446aadda95c06bf"
  it must "read another serialized Sprout proof" in {
    val jsdesc : JSDescription = RawJSDescriptionParser.read(rawJSDesc2)
    jsdesc.vpubOld must be (Satoshis(Int64(1000157527)))
    jsdesc.vpubNew must be (Satoshis(Int64(0)))
    encode(jsdesc.anchor.reverse) must be ("4773a88dd447e16e2db426aab120a2f6c7c2412c2476b1e5f30a43f077bb8f36")
    jsdesc.nullifiers.map(nf => encode(nf.reverse)) must be (List(
      "58f36162ac6d2c0c46753cb43a34f1dc4a7774ba645d2b0faa7abc7a586a3a9e",
      "cf1cc30eeae60f6bb95feb9ee4fd1b4fa9f30dae90b909baaac98314188dc98c"))
    jsdesc.commitments.map(cm => encode(cm.reverse)) must be (List(
      "0500eb7eafaeee94052dab3ced1d5cc84618e584e6b9e22ba2d376dee459a20c",
      "17b71ae2117b843d4d6326eb052e4018ea806cfeebb47b96a15a4da574c51faa"))
    encode(jsdesc.onetimePubKey.reverse) must be ("51f4c8ed89518a51ffafb5fa462e71eeddf1cad91448144f079299ef2e46a814")
    encode(jsdesc.randomSeed.reverse) must be ("bd3d153f0d3bd975fa9a699d3d759f1d68eaf7d90fe40a534397728a0512a9bb")
    jsdesc.macs.map(mac => encode(mac.reverse)) must be (List(
      "c45b758fdfa8e1e84310540718c1d2750288045a9dba7a00f4a9d600f5a681ad",
      "f6c349ccc62bb2993a7de6da7f54be1aacecb27bbb7a45a86907bfd06bdc9423"))
    jsdesc.proof.hex must be ("020d33cf689264dfbe12e42806e8597b9834ef127c4723ac06e96645731e486438031e29277c1bba25160ed46433e20ed031cbf3c593119171ba79e45a5e3d88e11c0a052150e32a281f231cb71fb408ef2b5757413c6d5c83e8b13aa915053a0689678b87d60bd814b5a985ddc0452e12964bd42534d355c2bd3ed645b79a5c2d171c022760b09bebeded7c95ca8046d64eb1a06ee52fc00e5183fa37c2b9a600bb679f0221422fdb7f491fc51adc33820a5ad4f6c8a01f8f75b5e9a453c7aa16a108a68302105f99acfb406c86412b5c6bdf1a9a86538c6e92327ac11c853d28b184708aaf021b416342c222c1f6b3bcd91dfcf70acee747e0b7f8979b83d8cd539d4743ebec0328c3d7cf3a8c009ae97139ffe2ff65d4e4cfe9c69bf385f8c380656286844477")
    jsdesc.ciphertexts.map(ct => encode(ct)) must be (List(
      "24b091f8e0d07ed8a031ca3d3072808518f8fb7706e6fa02fd368fa96a411c5a908b1c35906b0cd63e5792f41accf445e50e8202d264bc03fdfa881c01f8fd6c72e5bc53b81130be846815951b774dfee70f43a9391041822ec3f3ff7cbdc2d6566e5c2141b53e229133b39a2cd229eb941b8ddcfe02546950bd83925eec3c5061edd461bfbeddeeffae15c437f5b62c18bf41321ed394ff43183126dcdb998f96b34c717e6352cde474da63b4073a904ac48c458f00b606cb4cc5fbf08200d3e2bf637f730df86dcd18ffd033c47bbd26e8d669b80e3cc99ba4d9856d4202f3e119c8b6ed553201fd9b9138db486173bc9e3e42b6d5fb86190dfe52585e083eb982c67fb0a19945354be467cfb8d745d4e0b093f7b12a82b2e656e1e5ebfa44f83903f9b786589b4e56310fe8893f2a4333949d31df5abef6bd3020be995474d7d40954cde22d0dbfbb30edd252c341e1ccd121a3e09d80749caa290d231bc0018f65911a8b1d3f51ec30560366157ebf44b6efc1e6332f9b9bb5f8171f5a121043245daf7b9ab339716b51d808791b56525b5837fa24118a292358c7d81b02c0ea4d84047e17c19ab87c3c2a816c186dedfc60a78cd7aa7b1089fd7eb65865e0d1077975435545e67bda7a2f66f2dd5ab2bd3a4196fc206028ad2e291590af5138a348c383b78acdb0d8b72eb971ae5ab8536e30b76abe16255ce19c15f9797422d8cf401934d38f80e86532606c6e34beab39d57590d2c28f298115c368ca187cf2fd01244bdbe05d03386657a7b8548ce2156a1a6647b8dfada3de3db040786c987789281b6426dab5b01e49e3bc17fb1b831ae9a56444",
      "2cd992f8f1f3f4e366356ff12370b775fd444e571377e652254fdd6adb30ae40815ee18fa4af7a76c0792eb0b621b118d8451c1a242938c43913b5386e03a7fea0f13a4b0381114016afc0ac43e6e3b1bc5bac8eb2c8bc814627c58ebdc548a7628ebffa6f6457445689fa397817757b3bf715456b86c0fb3df95cc0dc4a06f9e418489162143cadc1e295e6ac9aad88471477b53c2fd43bdf2730aa7fcc49f89dbac72d414d1836ab4cb34fd3fce1bd9b0645cf7beb42c811de3416280c229ea8d19af499570f013e7a8e1c9b7dcd57674e3422ac0f62cf8186a04890b98340186d371cf00850e986e3b71f8578fe75b6672a06ac475f0256a76ef45ac78e669a969eefd424703d857e8ee573c3303928d2441ea8f5928ce62bbe7ee91b81fa9a4aabde5a39917fb4624215090af2daec3da3795ea695b7aae1cfbaca12b80c0ab2f21e42b7a0cf457b026c459276b63217a4a31b381d703b3e53a92f189cbd3be3fc8034cf3f8651054073e2f0448bd1e806c93eb7c7e5d0bb9b2de21d51bacf216271b5cee9b445d61fa7f2d7aaf469003e1240fb562a17e81fdc3931ad64c35ddc1d99474fad4507d230e639a8db3f19f863d8dbc0127417f6175cde0b62945d5e6247623dcce23f3f2d05d62dc1c6339827dee5ac76d1e80fd2c82dd955bd62b3e20e065fa47806080544d1b97f89ddbeacfed10db77152e0983c5cca03010eedd8a40245e8035c95c08b6f2ab9e07aebdec03a4faf020997088b2773a0ff8b0b142e2b138d85d6b0107205aaecb012b35174f56d600eb80c77c3bf865ce5523f878d23fed4a8d9b92e14a6aa5e6f1446aadda95c06bf"))
  }

  it must "serialize a JoinSplit descriptor" in {
    val jsdesc = RawJSDescriptionParser.read(rawJSDesc1)
    encode(RawJSDescriptionParser.write(jsdesc)) must be (rawJSDesc1)
  }
}